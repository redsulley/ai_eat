<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¥—å®´å°è¦½ - AI ç¾é£Ÿç°¡ä»‹</title>
    <!-- å¼•å…¥ jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        :root {
            --primary-color: #e67e22;
            --secondary-color: #f39c12;
            --bg-color: #fffaf0;
            --text-color: #2c3e50;
            --card-bg: #ffffff;
        }

        body {
            font-family: "Microsoft JhengHei", "PingFang TC", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        header h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            color: #7f8c8d;
        }

        /* è¼¸å…¥å€å¡Š */
        .input-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        input[type="text"] {
            flex: 1;
            padding: 15px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background 0.3s, transform 0.2s;
        }

        button:hover {
            background-color: #d35400;
        }

        button:active {
            transform: scale(0.95);
        }

        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }

        /* çµæœé¡¯ç¤ºå€å¡Š */
        .result-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            min-height: 200px;
            display: none; /* é è¨­éš±è—ï¼Œæœ‰å…§å®¹æ‰é¡¯ç¤º */
        }

        .result-title {
            color: var(--primary-color);
            border-left: 5px solid var(--primary-color);
            padding-left: 15px;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .result-content {
            white-space: pre-line; /* ä¿ç•™æ›è¡Œ */
            color: #444;
            font-size: 1.1rem;
        }

        /* è¼‰å…¥ä¸­å‹•ç•« */
        .loader {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-msg {
            color: #e74c3c;
            background: #fdf2f2;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        @media (max-width: 600px) {
            .input-group {
                flex-direction: column;
            }
            button {
                padding: 15px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>ğŸ½ï¸ é¥—å®´å°è¦½</h1>
            <p>è¼¸å…¥ä»»ä½•é£Ÿç‰©åç¨±æˆ–ç¾é£Ÿå•é¡Œï¼ŒAI ç‚ºæ‚¨ç”Ÿæˆè©³ç´°ç°¡ä»‹</p>
        </header>

        <main>
            <div class="input-section">
                <div class="input-group">
                    <input type="text" id="userInput" placeholder="ä¾‹å¦‚ï¼šä»‹ç´¹ä¸€ä¸‹å°ç£ç‰›è‚‰éºµã€ä»€éº¼æ˜¯æ¾éœ²ï¼Ÿ" maxlength="100">
                    <button id="sendBtn">æ¢ç´¢ç¾é£Ÿ</button>
                </div>
                <div id="errorBox" class="error-msg"></div>
            </div>

            <div class="loader" id="loader">
                <div class="spinner"></div>
                <p>æ­£åœ¨å“åšèˆ‡æ§‹æ€ä¸­...</p>
            </div>

            <div class="result-section" id="resultSection">
                <div class="result-title" id="displayQuery">é—œæ–¼æ‚¨çš„ç¾é£Ÿæ¢ç´¢</div>
                <div class="result-content" id="resultText"></div>
            </div>
        </main>
    </div>

    <script>
        $(document).ready(function() {
            // æ³¨æ„ï¼šæ­£å¼ç’°å¢ƒè«‹å‹™å¿…å°‡ API Key ç§»è‡³å¾Œç«¯ PHP
            const apiKey = "AIzaSyAvF1XF2oSiAcdMSW0cKUnjDpYjGfpGNPI"; 
            const modelName = "gemini-2.5-flash-preview-09-2025";
            const systemPrompt = "ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„ç¾é£Ÿè©•è«–å®¶èˆ‡æ–‡åŒ–å­¸è€…ã€‚è«‹é‡å°ä½¿ç”¨è€…è¼¸å…¥çš„é£Ÿç‰©æˆ–ç¾é£Ÿå•é¡Œï¼Œæä¾›è±å¯Œã€å„ªé›…ä¸”å¼•äººå…¥å‹çš„ç°¡ä»‹ã€‚å…§å®¹æ‡‰åŒ…å«ï¼šé£Ÿç‰©èµ·æºã€ä¸»è¦ç‰¹è‰²ã€å£æ„Ÿæè¿°æˆ–æ¨è–¦åƒæ³•ã€‚è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚ä¸è¦ä½¿ç”¨èŠå¤©å®¤å£å»ï¼ˆä¾‹å¦‚ï¼šä½ å¥½ã€æˆ‘èƒ½å¹«ä½ ä»€éº¼ï¼‰ï¼Œç›´æ¥é€²å…¥ä¸»é¡Œã€‚";

            $("#sendBtn").click(function() {
                const query = $("#userInput").val().trim();
                if (!query) return;

                performQuery(query);
            });

            // æ”¯æ´ Enter éµ
            $("#userInput").keypress(function(e) {
                if (e.which == 13) {
                    $("#sendBtn").click();
                }
            });

            async function performQuery(query) {
                // UI ç‹€æ…‹åˆ‡æ›
                $("#sendBtn").prop("disabled", true);
                $("#errorBox").hide();
                $("#resultSection").fadeOut(200);
                $("#loader").fadeIn(200);

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{
                        parts: [{ text: query }]
                    }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    }
                };

                let retryCount = 0;
                const maxRetries = 5;

                async function fetchWithRetry() {
                    try {
                        const response = await fetch(apiUrl, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const data = await response.json();
                        const aiResponse = data.candidates?.[0]?.content?.parts?.[0]?.text;

                        if (aiResponse) {
                            displayResult(query, aiResponse);
                        } else {
                            throw new Error("æœªèƒ½ç²å–æœ‰æ•ˆçš„ AI å›æ‡‰");
                        }

                    } catch (error) {
                        if (retryCount < maxRetries) {
                            const delay = Math.pow(2, retryCount) * 1000;
                            retryCount++;
                            setTimeout(fetchWithRetry, delay);
                        } else {
                            showError("æŠ±æ­‰ï¼Œç›®å‰ç¾é£Ÿç™¾ç§‘æš«æ™‚ç„¡æ³•é€£ç·šï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
                        }
                    }
                }

                fetchWithRetry();
            }

            function displayResult(query, content) {
                $("#loader").hide();
                $("#sendBtn").prop("disabled", false);
                
                $("#displayQuery").text(`æ¢ç´¢ï¼š${query}`);
                $("#resultText").text(content);
                $("#resultSection").fadeIn(500);
                
                // è‡ªå‹•æ²å‹•åˆ°çµæœå€
                $('html, body').animate({
                    scrollTop: $("#resultSection").offset().top - 20
                }, 800);
            }

            function showError(msg) {
                $("#loader").hide();
                $("#sendBtn").prop("disabled", false);
                $("#errorBox").text(msg).show();
            }
        });
    </script>
</body>
</html>